# 淘宝订单匹配与上色处理说明

## 📋 任务概述

对淘宝订单表格进行自动化匹配和颜色标记，用于区分已处理和未处理的订单。

## 📁 文件说明

### 输入文件

1. **新表（主表）**: `2026淘寶結賬.xlsx`
   - 工作表: `2025淘寶`
   - 总行数: 1,903 行
   - 列数: 14 列
   - 说明: 包含所有最新订单数据的主表

2. **旧表（参考表）**: `淘寶暫時清單 2025.11.15.xlsx`
   - 使用的工作表:
     - `媽媽` 页: 733 行（已处理的媽媽订单）
     - `其他` 页: 99 行（已处理的其他订单）
   - 说明: 已经分类处理过的历史订单

### 输出文件

- **已上色文件**: `2026淘寶結賬_已上色.xlsx`
- **备份文件**: `2026淘寶結賬_backup_YYYYMMDD_HHMMSS.xlsx`

## 🎯 处理逻辑

### 匹配规则

使用 **订单编号**（第2列）作为唯一标识进行匹配：

1. 如果新表中的订单号存在于旧表的 `媽媽` 页 → 标记为**淡红色**
2. 如果新表中的订单号存在于旧表的 `其他` 页 → 标记为**淡黄色**
3. 如果订单号同时存在于 `媽媽` 和 `其他` 两页 → 标记为**大红色**（异常情况）

### 上色范围

对匹配到的订单进行**整行上色**（所有14列都会被标记）

## 🎨 颜色设置

| 分类 | 色码 | 颜色效果 | 说明 |
|------|------|---------|------|
| 媽媽页订单 | `FFE6E6` | 🔴 淡红色 | 已处理的媽媽订单 |
| 其他页订单 | `FFFFE0` | 🟡 淡黄色 | 已处理的其他订单 |
| 重复订单 | `FF0000` | 🔴 大红色 | 异常：同时存在于两页 |

### 色码格式说明

- 色码格式: 16进制 RGB（无 # 前缀）
- `FFE6E6` = RGB(255, 230, 230) - 浅粉红色
- `FFFFE0` = RGB(255, 255, 224) - 浅黄色
- `FF0000` = RGB(255, 0, 0) - 纯红色

## 🔧 技术实现

### 使用的库

```python
openpyxl  # Excel 文件读写
pandas    # 数据处理（备用）
```

### 核心代码结构

```python
# 文件配置
OLD_FILE = "淘寶暫時清單 2025.11.15.xlsx"
NEW_FILE = "2026淘寶結賬.xlsx"

# 颜色定义
COLOR_MOM = "FFE6E6"       # 淡红色（媽媽页）
COLOR_OTHER = "FFFFE0"     # 淡黄色（其他页）
COLOR_DUPLICATE = "FF0000" # 大红色（重复）
```

### 处理流程

```
1. 创建备份文件
   └─ 备份格式: 原文件名_backup_时间戳.xlsx

2. 读取旧表订单编号
   ├─ 读取 '媽媽' 页的订单编号 → mom_orders (集合)
   └─ 读取 '其他' 页的订单编号 → other_orders (集合)

3. 检查重复订单
   └─ 计算交集: mom_orders ∩ other_orders

4. 处理新表
   ├─ 遍历新表的每一行
   ├─ 提取订单编号
   ├─ 判断订单所属分类
   └─ 应用对应的背景色

5. 保存结果
   └─ 输出: 2026淘寶結賬_已上色.xlsx
```

## 📊 处理结果

### 统计数据

```
旧表订单统计:
├─ 媽媽页: 277 个订单编号
└─ 其他页: 50 个订单编号

新表匹配结果:
├─ 淡红色（媽媽页）: 275 个订单
├─ 淡黄色（其他页）: 50 个订单
└─ 大红色（重复）: 0 个订单 ✓

总计: 325 个订单被标记
未标记: 1,578 个订单（新订单）
```

### 差异说明

- 旧表 `媽媽` 页有 277 个订单，但新表中只匹配到 275 个
- 可能原因: 2个订单编号在新表中不存在（已取消/删除的订单）

## 🚀 使用方法

### 运行脚本

```bash
python process_orders.py
```

### 自定义颜色

如需修改颜色，编辑 `process_orders.py` 中的色码：

```python
# 在文件开头修改
COLOR_MOM = "你的色码"       # 例如: "FFB6C1" (粉红色)
COLOR_OTHER = "你的色码"     # 例如: "FFFACD" (柠檬黄)
COLOR_DUPLICATE = "你的色码" # 例如: "DC143C" (深红色)
```

### 常用颜色参考

| 颜色 | 色码 | 效果 |
|------|------|------|
| 浅粉色 | `FFB6C1` | 粉嫩 |
| 淡蓝色 | `ADD8E6` | 清爽 |
| 淡绿色 | `90EE90` | 清新 |
| 淡紫色 | `E6E6FA` | 淡雅 |
| 浅橙色 | `FFDAB9` | 温暖 |

## 📝 工具脚本

### 1. `xlsx_inspector.py` - 文件检查工具

功能: 安全检查 xlsx 文件结构，不修改原文件

```bash
python xlsx_inspector.py
```

输出:
- 工作表列表
- 每个工作表的行列数
- 前5行数据预览

### 2. `process_orders.py` - 订单匹配上色工具

功能: 主处理脚本，执行订单匹配和上色

```bash
python process_orders.py
```

输出:
- 备份文件
- 已上色的新表
- 统计报告

## ⚠️ 注意事项

1. **备份安全**: 每次运行会自动创建带时间戳的备份文件
2. **订单编号格式**: 订单编号会自动去除首尾空格并转为字符串进行匹配
3. **重复检测**: 如发现同一订单同时存在于两页，会自动标记为大红色
4. **文件编码**: 脚本已处理 UTF-8 编码，支持中文文件名和内容
5. **列位置**: 订单编号默认在第2列（索引1），如文件格式变化需调整代码

## 🛠️ 环境要求

```bash
Python 3.14.2
openpyxl 3.1.5
pandas 2.3.3
```

安装依赖:
```bash
pip install openpyxl pandas
```

## 📅 版本信息

- 创建日期: 2026-01-11
- 版本: 1.0
- 作者: Claude Code
- 处理记录: 2026淘寶結賬.xlsx (1,903行订单)

## 🔄 后续改进建议

1. 添加图形界面（GUI）方便非技术用户使用
2. 支持自定义匹配列（不仅限于订单编号）
3. 生成详细的 Excel 报表（包含统计图表）
4. 支持多文件批量处理
5. 添加订单差异分析功能（找出缺失的订单）

---

**文档结束** | 如有问题请参考脚本中的注释或重新运行检查工具
